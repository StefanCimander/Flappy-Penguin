/* http://flappybird.io */

var REWARD_MID = 100,
    REWARD_DEFAULT = 1,
    PUNISHMENT = -1024,
    epsilon = 0.1,
    gamma = 0.9,
    alpha = 0.25;

var testCanvas = document.getElementById('testCanvas');
var ctx = testCanvas.getContext('2d');

var qtable = {"101057026":{"jump":29.958280286001795,"stay":21.063980514834924},"101057030":{"jump":6.459416932943528,"stay":7.190861391003669},"101057034":{"jump":-1.7214796832026718,"stay":3.2853993165984856},"101057042":{"jump":4.46576970702445,"stay":1.3134261289973077},"101057058":{"jump":2.5796800034560396,"stay":-82.21848022663005},"101057062":{"jump":4.296179911230701,"stay":0.017410582905474925},"101057090":{"jump":5.26122133933042,"stay":7.1852066175159965},"101057098":{"jump":7.53747956673836,"stay":7.872311295972622},"101057154":{"jump":5.070651311450076,"stay":3.272930528244639},"101057170":{"jump":6.129439797782947,"stay":7.935271946449733},"101057282":{"jump":-1.8182906667536365,"stay":0.20964196773316246},"101057310":{"jump":4.680144824129934,"stay":9.074088424569752},"101057314":{"jump":5.171595894537539,"stay":6.635283453161344},"101057342":{"jump":7.179958471315419,"stay":7.5373400292874795},"101057422":{"jump":4.356187152548798,"stay":3.773864188276529},"101057438":{"jump":8.592290779790634,"stay":9.35612684046348},"101057478":{"jump":7.61504112002164,"stay":6.661841160894911},"101057486":{"jump":8.039428648364094,"stay":7.541775588246585},"101057506":{"jump":-2.6863132835309074,"stay":-2.9437316641367914},"101057510":{"jump":-4.533778041116641,"stay":-10.146516451740343},"101057522":{"jump":5.558913602214808,"stay":5.382089466162358},"101058502":{"jump":4.141989712364902,"stay":1.1929244177104794},"101059470":{"jump":3.787335611926671,"stay":-1.6391790969810613},"101061406":{"jump":1.3148291750323131,"stay":-5.741473493299909},"101061618":{"jump":0.5865685725539644,"stay":-0.32262026491637696},"101065698":{"jump":-3.9394408549051265,"stay":-8.573814615674584},"101066726":{"jump":0.5354700734080893,"stay":-1.2705807117142496},"101073862":{"jump":2.8934080108977738,"stay":-3.1175924834577264},"101075918":{"jump":4.412805724580325,"stay":-0.8348988374176849},"101090190":{"jump":1.9788360397803202,"stay":0.5705672593433171},"101094302":{"jump":3.4406593699788255,"stay":2.412960124325514},"101122846":{"jump":0.37776530871220404,"stay":-6.287270580972187},"101129730":{"jump":-11.05471400265608,"stay":-10.40000460182533},"101129746":{"jump":-1.7561300151506316,"stay":-7.435722506486671},"101129986":{"jump":-9.137829540483676,"stay":-181.1791173629814},"101130002":{"jump":1,"stay":-1.5837244829781927},"101130014":{"jump":-7.059604617702368,"stay":-0.5511352881980418},"101131070":{"jump":2.1696953413748234,"stay":6.633359324905608},"101137922":{"jump":6.98844689579408,"stay":6.908806920377991},"101138178":{"jump":4.415900342953379,"stay":7.178197458000128},"101138210":{"jump":1,"stay":-40.88715655609417},"101138238":{"jump":3.758972572321738,"stay":5.9870916525364795},"101158402":{"jump":-4.43737115482652,"stay":-1.7771914070501906},"101158410":{"jump":0.9808375512442442,"stay":-3.457137267137093},"101158530":{"jump":-2.2149350045466147,"stay":-4.862139116800652},"101158786":{"jump":1.981133884428337,"stay":-21.31693948107959},"101158794":{"jump":2.1685190529403804,"stay":-0.46684326254571973},"101158798":{"jump":-2.9388445293283603,"stay":-0.5070336744043755},"101162498":{"jump":-5.814220624397582,"stay":-4.9586963704302995},"101162626":{"jump":-0.9060587356114979,"stay":0.8940603572242302},"101162642":{"jump":1.3542209717770075,"stay":1.3876568882169957},"101162898":{"jump":0.39018319171595633,"stay":-1.9686290755081175},"101162910":{"jump":3.233204710627267,"stay":5.713890150877351},"101172738":{"jump":-22.27049397845567,"stay":-25.02017431814796},"101172742":{"jump":-4.48799290142954,"stay":-8.829759049728434},"101172802":{"jump":-0.24876312138016787,"stay":-8.438022225750949},"101173186":{"jump":-0.34313524077312274,"stay":-0.366741171431747},"101173190":{"jump":-0.14554240836376292,"stay":-1.3854815473735296},"101174786":{"jump":-0.8949165432880092,"stay":-4.0997165823607835},"101174850":{"jump":1.8816891143288217,"stay":-11.56711641774304},"101174858":{"jump":1,"stay":0.20462293931335213},"101175242":{"jump":0.30507047092216644,"stay":3.345059528587804},"101175246":{"jump":1.9628462876097867,"stay":-95.65566654069826},"101179906":{"jump":-35.29945369335906,"stay":-27.22471034240855},"101179938":{"jump":-10.993983284611037,"stay":-15.017873150676367},"101180386":{"jump":-10.65225507419098,"stay":-18.610508695079403},"101180930":{"jump":-9.62667956594958,"stay":-6.371863095896943},"101180962":{"jump":-11.355966469872534,"stay":-18.829391130099275},"101180966":{"jump":-0.4225241810399383,"stay":-7.077792241412225},"101181414":{"jump":-4.497800536311396,"stay":-2.348260393585298},"101184002":{"jump":-4.367352964704068,"stay":-1.471674269321913},"101184018":{"jump":-8.169266383817822,"stay":-4.644028407007898},"101184498":{"jump":-1.7828956459493681,"stay":-0.6082757765975316},"101682690":{"jump":1.878618733759493,"stay":-13.628164008255805},"102178306":{"jump":-2.9407224745611407,"stay":-42.39925553429944},"102232578":{"jump":0.1316795618200861,"stay":-30.500384691159585},"103277058":{"jump":1,"stay":-31.265610398072866},"103278082":{"jump":1,"stay":-28.93749300588241},"105367042":{"jump":-38.913944912011715,"stay":-21.418840234501776},"105893378":{"jump":-3.4208142390324383,"stay":-12.741615221835596},"109547010":{"jump":1.39375,"stay":-17.41643325753938},"109551106":{"jump":1.275625,"stay":1},"110599682":{"jump":-4.001295389785543,"stay":-25.564122064004057},"117906946":{"jump":-4.023499409127383,"stay":-26.09571424624624},"117915138":{"jump":1,"stay":2.3831502750830396},"119407106":{"jump":-69.99439558936166,"stay":-49.94664808461677},"119411202":{"jump":-36.656207617303,"stay":-49.848635096213776},"119472642":{"jump":-10.745223028247787,"stay":-52.81690376237275},"119479810":{"jump":-37.718662368738485,"stay":-44.07744585659255},"120012290":{"jump":2.7815621213210346,"stay":4.809454473520431},"121504258":{"jump":-8.954756646477172,"stay":-9.3173506218567},"121577986":{"jump":1.8616763838993582,"stay":-0.8135317995398159},"121585154":{"jump":3.8896815779581826,"stay":0.23535434570914537},"126747138":{"jump":-39.21702136135404,"stay":-67.4860661495421},"126749186":{"jump":-13.922345761503962,"stay":-42.02770468654312},"126779906":{"jump":-26.98053407406077,"stay":-39.01434754694856},"126845442":{"jump":1,"stay":-10.239532605021104},"126848514":{"jump":-23.953575084290954,"stay":-27.77104445554337},"127795714":{"jump":-68.13676215447742,"stay":-64.92333549613478},"127832578":{"jump":-34.18351101149791,"stay":-51.020164484396226},"127901186":{"jump":-31.7798975927607,"stay":-41.93603442800614},"130417154":{"jump":-50.04522851371937,"stay":-40.41619279188406},"130418178":{"jump":-24.626439056297734,"stay":-50.83485319888651},"130433538":{"jump":-16.903831232568876,"stay":-64.26380026015724},"130532866":{"jump":-43.910565826142076,"stay":-39.433186487366626},"130941442":{"jump":-55.47865070769222,"stay":-51.833641784851594},"130959874":{"jump":-28.96208675168775,"stay":-40.37207252977319},"131059202":{"jump":-18.906861702473897,"stay":-32.948881698213455},"132514306":{"jump":-45.54448013413735,"stay":-54.89699030147728},"132522498":{"jump":-37.46851932224407,"stay":-41.68823977813579},"132523522":{"jump":-50.77433083836524,"stay":-56.83768834132873},"132637186":{"jump":-43.33926351523536,"stay":-37.13925372353009},"132638210":{"jump":-41.95621757301338,"stay":-37.642240175606986},"133562882":{"jump":-71.96798924350641,"stay":-78.36826008680588},"133566978":{"jump":-14.643366288195875,"stay":-59.334656382982374},"133689858":{"jump":-42.1271042742782,"stay":-47.2700137212009},"235274754":{"jump":-71.36986424448378,"stay":-66.76201165884171},"235799042":{"jump":-259.11520001747215,"stay":-260.32742006714454},"235799078":{"jump":1,"stay":-71.2292911160325},"235799186":{"jump":1,"stay":-85.67856055947433},"235799326":{"jump":1,"stay":-76.2644551754908},"235799438":{"jump":1,"stay":-107.27897360175304},"235799454":{"jump":1,"stay":-31.463132318597737},"235799494":{"jump":1,"stay":-172.58397180365796},"235799502":{"jump":-47.575223035468305,"stay":-54.902179573436285},"235799522":{"jump":-57.32881395611215,"stay":-115.72361037759562},"235799526":{"jump":-44.68219375660876,"stay":-53.04138716265908},"235799538":{"jump":-75.31635919884381,"stay":-156.1603841021377},"235800518":{"jump":1,"stay":-73.25461573905403},"235832206":{"jump":1,"stay":-9.788851406782419},"235879938":{"jump":1,"stay":-91.70933680314496},"235900418":{"jump":1,"stay":-193.13510677972474},"235904642":{"jump":1,"stay":-75.7722389793805},"235904926":{"jump":-64.43631632966607,"stay":-84.9556941100577},"235915206":{"jump":-68.02645305472682,"stay":-49.5726784724027},"235916802":{"jump":1,"stay":-49.696565831539374},"235921922":{"jump":1,"stay":-91.74212383384697},"235922946":{"jump":1,"stay":-69.09458077785229},"235923430":{"jump":1,"stay":-64.42535536583601},"235926018":{"jump":-81.35310908849597,"stay":1},"253624834":{"jump":1,"stay":-113.41634001022561},"260964866":{"jump":-79.05178091545062,"stay":-94.60119886408098},"261066242":{"jump":1,"stay":-70.35073432513187},"262118914":{"jump":1,"stay":-40.40909148321356},"265159170":{"jump":1,"stay":-51.47932299233929},"265177602":{"jump":1.225,"stay":1},"265274882":{"jump":-78.57757089515968,"stay":1},"267256322":{"jump":1,"stay":-113.25076804166416},"268431874":{"jump":1,"stay":-59.08881757786042},"369492482":{"jump":3.249415132827332,"stay":-6.981020741635028},"387842562":{"jump":-57.68904812286601,"stay":-116.61886587878803},"401998338":{"jump":-105.44802524765944,"stay":-102.64912213820855},"503710210":{"jump":-257.66946751588733,"stay":-214.4032337161463},"504234498":{"jump":-102.85929606934124,"stay":-261.8468406948925},"504758786":{"jump":-1.0798266929348412,"stay":-146.57415199364502},"520487426":{"jump":1,"stay":-186.19502728663764},"522060290":{"jump":-120.9429502142143,"stay":-61.75673214372882},"637927938":{"jump":-73.77541069382217,"stay":-23.195860220656073},"658375170":{"jump":-29.157413012618335,"stay":-35.466461699249464},"669385218":{"jump":-79.40675003792674,"stay":-89.21643662825844},"1040581122":{"jump":-84.4360336640573,"stay":-181.02911776935437},"1041105410":{"jump":-895.6642935680625,"stay":-925.667896730512},"1041105414":{"jump":-342.6930638628668,"stay":-367.36696612811056},"1041105418":{"jump":1,"stay":-818.245269727902},"1041105426":{"jump":1,"stay":-482.35148217169893},"1041105442":{"jump":1,"stay":-582.2061863821708},"1041105446":{"jump":1,"stay":-752.9008194923422},"1041105474":{"jump":1,"stay":-421.9389040648919},"1041105554":{"jump":-249.025,"stay":-912.6784136761398},"1041105694":{"jump":-1000.2286320164112,"stay":-905.7708730612853},"1041105726":{"jump":-639.1200072495077,"stay":-730.1032351756462},"1041105806":{"jump":-897.2411967099432,"stay":-1335.6094763050523},"1041105822":{"jump":-1265.6230502549404,"stay":-811.5716701045735},"1041105862":{"jump":-625.4229912817823,"stay":-1325.7038098798175},"1041105870":{"jump":-367.21198141319377,"stay":-823.409949704921},"1041105890":{"jump":-1450.7288466288073,"stay":-1300.8263511229457},"1041105894":{"jump":-553.8261330936142,"stay":-1036.6626180604412},"1041105906":{"jump":-1063.870240913417,"stay":-1366.4122713307836},"1041106886":{"jump":1,"stay":-868.3274042319558},"1041114082":{"jump":1,"stay":3.1472187826878297},"1041115110":{"jump":1,"stay":-501.79636989357994},"1041122246":{"jump":-415.6131691647248,"stay":-249.025},"1041124302":{"jump":1,"stay":-720.3604016254176},"1041138574":{"jump":-249.025,"stay":-904.9915623268694},"1041142686":{"jump":1,"stay":-135.74670686880222},"1041171230":{"jump":1,"stay":-184.26878674050954},"1041178114":{"jump":-436.5877674948698,"stay":-782.971059877579},"1041178370":{"jump":1,"stay":-848.475663937161},"1041178398":{"jump":-755.3641312201527,"stay":-419.185842569995},"1041186306":{"jump":-379.44734117288283,"stay":-560.5193714569263},"1041186594":{"jump":1,"stay":3.1729325137037607},"1041186622":{"jump":3.249367725708935,"stay":-410.16296329316316},"1041206786":{"jump":-1129.1792370418873,"stay":-1245.3400733047197},"1041206914":{"jump":1,"stay":-184.27091040776065},"1041207170":{"jump":1,"stay":-259.1627881347686},"1041207182":{"jump":-730.2371302719489,"stay":-1139.1964727563347},"1041210882":{"jump":-376.4641821693484,"stay":-1062.0917115230652},"1041211010":{"jump":1,"stay":-184.28215922999547},"1041211294":{"jump":-491.8081260455485,"stay":-968.052963724831},"1041221122":{"jump":-463.0257147104868,"stay":-846.8746331797206},"1041221126":{"jump":-610.7120262471066,"stay":1},"1041221186":{"jump":1,"stay":-729.8588975352935},"1041221574":{"jump":3.2432899912584334,"stay":-908.4958850483214},"1041223170":{"jump":-492.799375,"stay":-1222.828013321597},"1041223234":{"jump":1,"stay":-494.6869656408546},"1041223630":{"jump":-432.0821702614324,"stay":-1453.6105467843681},"1041228290":{"jump":-246.8438210616157,"stay":-685.0277205692181},"1041228770":{"jump":-867.4451185429086,"stay":-1042.6117138545808},"1041229314":{"jump":-848.5975634372262,"stay":-1054.5675945704684},"1041229346":{"jump":-249.025,"stay":2.6817227048810537},"1041229798":{"jump":-248.5514526190148,"stay":-813.0850040645205},"1041232386":{"jump":-558.87149486817,"stay":-1004.3710123343822},"1041232402":{"jump":3.2493793726750235,"stay":-308.8288051899321},"1041232882":{"jump":-492.799375,"stay":-1147.8008015575233},"1042226690":{"jump":1,"stay":-323.86338666527934},"1042280962":{"jump":1,"stay":-401.24953644529694},"1045415426":{"jump":1,"stay":-461.6113932091638},"1045417474":{"jump":1,"stay":3.2492699721781713},"1049595394":{"jump":1,"stay":-544.799966369333},"1050648066":{"jump":1,"stay":-384.73173326570173},"1058931202":{"jump":-865.1722813685996,"stay":-869.4125789676369},"1058996738":{"jump":1,"stay":-184.29517884830094},"1059003906":{"jump":-410.99971266717864,"stay":-781.3377430351737},"1059455490":{"jump":1,"stay":-72.27328493338798},"1061028354":{"jump":-26.777406444025033,"stay":-33.72774470294051},"1061102082":{"jump":1,"stay":-184.74721908296527},"1066271234":{"jump":-887.7884343551992,"stay":-1054.3039836967096},"1066304002":{"jump":-249.025,"stay":-351.0369168329041},"1066372610":{"jump":3.235156083930652,"stay":-908.8336426523163},"1067319810":{"jump":3.2340092994122687,"stay":-454.1875360734666},"1067356674":{"jump":-249.025,"stay":-554.1592933114124},"1067425282":{"jump":-631.5060938470878,"stay":-777.1264008416418},"1070465538":{"jump":-249.025,"stay":-651.7685218772554},"1070466562":{"jump":3.2499890596288337,"stay":-688.4214362677172},"1070481922":{"jump":1,"stay":-875.2996389785435},"1070483970":{"jump":1,"stay":-670.6263642191101},"1070581250":{"jump":3.249999798856252,"stay":-975.2741711909823},"1070583298":{"jump":1,"stay":-828.1842323467561},"1072562690":{"jump":-762.1056225738529,"stay":-1594.1736075429244},"1072570882":{"jump":1,"stay":-391.0422349748841},"1072571906":{"jump":1,"stay":-1083.3724684515917},"1072685570":{"jump":-536.3234865762098,"stay":-1173.4068362462783},"1072686594":{"jump":1,"stay":-1116.449995488602},"1073611266":{"jump":-421.0355396590332,"stay":-920.0998727831247},"1073738242":{"jump":-730.479390625,"stay":-398.09844897206835},"1174798850":{"jump":-48.74868100358953,"stay":-76.02610192803455},"1204158978":{"jump":-77.99084020875026,"stay":-85.42134656784877},"1204683266":{"jump":1,"stay":-71.85143793531805},"1309016578":{"jump":-67.75270926857131,"stay":5.787486574779068},"1338900994":{"jump":-74.85467890962362,"stay":-83.06145143835305},"1846411778":{"jump":-278.87408858328797,"stay":-288.97702672153036},"1846411786":{"jump":1,"stay":-95.38265507477941},"1846411814":{"jump":-42.42667642479699,"stay":1},"1846412062":{"jump":-74.63092837227184,"stay":-304.4523012088832},"1846412094":{"jump":1,"stay":-131.1818842233472},"1846412174":{"jump":-128.94356944691347,"stay":-255.66550659112093},"1846412190":{"jump":-37.330304139126056,"stay":-217.3258443359885},"1846412230":{"jump":-117.7980877177528,"stay":-233.3356923190788},"1846412238":{"jump":1,"stay":-190.73358190597952},"1846412258":{"jump":-157.51569984026958,"stay":-269.27083729982894},"1846412262":{"jump":1,"stay":-253.3413543317101},"1846412274":{"jump":1,"stay":-239.30279470834134},"1846444942":{"jump":-48.70045069681075,"stay":-178.9124642379002},"1846484482":{"jump":1,"stay":-146.22503353742718},"1846484738":{"jump":1,"stay":-71.50751090262986},"1846484766":{"jump":1,"stay":-192.23311830126679},"1846492674":{"jump":1,"stay":-133.7183568391958},"1846492962":{"jump":1,"stay":-46.25308959152465},"1846492990":{"jump":1,"stay":-79.00117160054697},"1846513154":{"jump":1,"stay":-147.05980232978663},"1846513550":{"jump":1,"stay":-58.480591630244355},"1846517662":{"jump":1,"stay":-97.63688996488585},"1846527490":{"jump":1,"stay":-163.94974419527517},"1846527942":{"jump":-71.2877294186876,"stay":-223.90187107542206},"1846529538":{"jump":-69.66959679814269,"stay":-179.91081610686044},"1846529998":{"jump":1,"stay":-28.83772408317789},"1846534658":{"jump":-46.646084661118884,"stay":-121.29067303352994},"1846535138":{"jump":-60.89343365343342,"stay":-236.3340989123079},"1846535682":{"jump":-84.95340831384472,"stay":-210.8772069087983},"1846536166":{"jump":1,"stay":-88.22594292606985},"1846538754":{"jump":1,"stay":-130.34739641280254},"1846538770":{"jump":1,"stay":-161.79251780583758},"1846539250":{"jump":-61.064366305621185,"stay":-59.71333808693896},"1847587330":{"jump":1,"stay":-38.92613211090386},"1850723842":{"jump":1,"stay":-58.37304875222356},"1854901762":{"jump":1,"stay":-28.96799464057327},"1855954434":{"jump":1,"stay":-66.8237570580412},"1864237570":{"jump":1,"stay":-175.5809153298023},"1864310274":{"jump":-65.05963684547199,"stay":-91.97315392406843},"1866334722":{"jump":1,"stay":-49.130689043036746},"1871577602":{"jump":-41.436843087975085,"stay":-186.8303121480855},"1871678978":{"jump":1,"stay":-174.25559095247024},"1872626178":{"jump":1,"stay":-75.66653513545423},"1872663042":{"jump":-57.73977179031354,"stay":1},"1875771906":{"jump":-74.14389515884581,"stay":-223.25901683909797},"1875790338":{"jump":1,"stay":-72.8690463728399},"1875887618":{"jump":1,"stay":-152.4909480006924},"1875889666":{"jump":1,"stay":-100.03710486462843},"1877869058":{"jump":-89.81406704580672,"stay":-196.90262801727292},"1877877250":{"jump":1,"stay":-78.27113718614986},"1877991938":{"jump":-57.035922380013865,"stay":-198.09711724170697},"1877992962":{"jump":1,"stay":-91.00364240701242},"1878917634":{"jump":1,"stay":-198.92301925730072},"1879044610":{"jump":1,"stay":-168.2105047635883},"2114847234":{"jump":-536.051657473233,"stay":-607.4876423822803},"2114847238":{"jump":1.39809794921875,"stay":-54.29930666503906},"2114847242":{"jump":-290.7698630348609,"stay":-247.09959482116346},"2114847250":{"jump":1,"stay":-17.43129155726128},"2114847266":{"jump":1,"stay":-13.299062929612191},"2114847270":{"jump":1.225,"stay":-264.3739192387741},"2114847298":{"jump":1,"stay":-248.37489326171874},"2114847378":{"jump":1.225,"stay":-103.3394650458126},"2114847518":{"jump":-627.0363963209663,"stay":-750.5290429004108},"2114847550":{"jump":-142.2714850350699,"stay":-304.11210851044916},"2114847630":{"jump":-447.14797042392564,"stay":-558.5135062734801},"2114847646":{"jump":-549.3068954073578,"stay":-717.7284126901825},"2114847686":{"jump":-423.61226150909977,"stay":-395.48574568882447},"2114847694":{"jump":1.866808984375,"stay":-366.5746248752875},"2114847714":{"jump":-679.9271029330698,"stay":-1008.4208105794573},"2114847718":{"jump":-152.44978679323395,"stay":-300.0426002533918},"2114847730":{"jump":-534.6453096610085,"stay":-650.9666448960295},"2114848710":{"jump":1,"stay":2.240106337879181},"2114855906":{"jump":1,"stay":-248.69171875},"2114856934":{"jump":1,"stay":1.5582812499999998},"2114864070":{"jump":1.225,"stay":1.444375},"2114866126":{"jump":1.225,"stay":2.0276040698242186},"2114880398":{"jump":1.440171625366211,"stay":-71.87587447756916},"2114884510":{"jump":1.35061328125,"stay":-248.29368166503906},"2114913054":{"jump":1,"stay":1.5582812499999998},"2114919938":{"jump":-510.66165738927793,"stay":-223.73276961622747},"2114920194":{"jump":1,"stay":-539.4234330809066},"2114920222":{"jump":-497.25037994768326,"stay":-801.0826775901398},"2114928130":{"jump":-63.44794527287095,"stay":-170.0427822883768},"2114928418":{"jump":1,"stay":-248.53130078125},"2114928446":{"jump":1.225,"stay":-127.88483426992156},"2114948610":{"jump":2.9830887152479346,"stay":-334.4803421113281},"2114948738":{"jump":1,"stay":-18.096402481197064},"2114948994":{"jump":1.444375,"stay":-447.5026925413225},"2114949006":{"jump":2.3249581653723275,"stay":-199.04585589542856},"2114952706":{"jump":-247.8559936005912,"stay":-125.5252140820867},"2114952834":{"jump":1,"stay":1.5582812499999998},"2114953118":{"jump":-514.0083471764467,"stay":-245.15007676166272},"2114962946":{"jump":-110.74828861861454,"stay":-249.10795799763235},"2114962950":{"jump":1.225,"stay":1.444375},"2114963010":{"jump":1.6582656249999999,"stay":-327.39977328567505},"2114963398":{"jump":2.9763315469044467,"stay":-122.45128834726705},"2114964994":{"jump":-53.08916503906249,"stay":-449.49354410372956},"2114965058":{"jump":1,"stay":1.5582812499999998},"2114965454":{"jump":1.225,"stay":-158.75192364349664},"2114970114":{"jump":2.5489065149155805,"stay":-347.1681298804589},"2114970594":{"jump":-263.0466202100138,"stay":-733.8549428567949},"2114971138":{"jump":2.160493428704834,"stay":-573.6395832331896},"2114971170":{"jump":1,"stay":-18.808553049138027},"2114971622":{"jump":1.225,"stay":-108.95063568351607},"2114974210":{"jump":-42.78038981684474,"stay":-235.01432748185147},"2114974226":{"jump":1,"stay":-327.5385404460907},"2114974706":{"jump":-53.97802093017578,"stay":-49.5971925993897},"2115968514":{"jump":1,"stay":-248.37489326171874},"2116022786":{"jump":1,"stay":-248.53130078125},"2119157250":{"jump":1,"stay":2.203086806629181},"2119159298":{"jump":1,"stay":-269.51013459259997},"2123337218":{"jump":1.225,"stay":1.59530078125},"2124389890":{"jump":1,"stay":-270.52281479289536},"2132673026":{"jump":-600.4938454138768,"stay":-639.2256788568196},"2132738562":{"jump":1,"stay":1.5582812499999998},"2132745730":{"jump":1.7990624709472653,"stay":-168.30751427435396},"2134770178":{"jump":2.2683852907714845,"stay":-302.2702170271713},"2134843906":{"jump":1,"stay":1.5582812499999998},"2140013058":{"jump":1.275625,"stay":-439.89287529312037},"2140045826":{"jump":1.39375,"stay":-34.74082537815743},"2140114434":{"jump":2.084296802368164,"stay":-57.18511564625176},"2141061634":{"jump":1.6999616831111095,"stay":-247.29387481825344},"2141098498":{"jump":1,"stay":1.9563183349609377},"2141167106":{"jump":-328.23013918234307,"stay":-67.60325264178415},"2144207362":{"jump":-365.56101464326235,"stay":-223.83867762514245},"2144208386":{"jump":1,"stay":2.462565873377425},"2144223746":{"jump":1.225,"stay":1.87510673828125},"2144225794":{"jump":1,"stay":1.9563183349609377},"2144323074":{"jump":2.516288765361023,"stay":-106.57582508758728},"2144325122":{"jump":1.7186992187499999,"stay":-12.058813430640537},"2146304514":{"jump":-273.06205676228933,"stay":-424.16679378516767},"2146312706":{"jump":2.500625,"stay":-254.10625000000002},"2146313730":{"jump":1.39809794921875,"stay":2.130077313690186},"2146427394":{"jump":-369.120180409823,"stay":-383.9073336431032},"2146428418":{"jump":-248.72968749999998,"stay":1.4575295096555951},"2147353090":{"jump":-286.21402847272446,"stay":-574.7692466759147},"2147480066":{"jump":-124.81156736374338,"stay":-315.1593441790271},"2147483646":{"jump":-53.541117795166016,"stay":-289.69535511225104},"-2":{"jump":-367.56250171605416,"stay":-400.38614846606646},"-134217730":{"jump":-77.03148785750496,"stay":-294.57038551079717},"-404356606":{"jump":-83.71978805216673,"stay":-96.32613022099801},"-435813886":{"jump":-125.96161390970576,"stay":-219.7004524731589},"-32636414":{"jump":-833.2785443469684,"stay":-1232.3338818564823},"-808582654":{"jump":-78.26320683010549,"stay":-119.2436044155278},"-838467070":{"jump":-134.60850002266528,"stay":-205.34688977487613},"-301071870":{"jump":-284.38289959818917,"stay":-278.7539420867236},"-1617034750":{"jump":-106.187799274638,"stay":-66.01371508085123},"-1634336254":{"jump":1,"stay":-184.25961290932514},"-1643773438":{"jump":-239.9815276587449,"stay":-334.00441284122456},"-1106378238":{"jump":-1927.903405277252,"stay":-1683.6052000855439},"-433716734":{"jump":-37.459307696780996,"stay":-123.8473509702893},"-134872574":{"jump":-125.42848970694267,"stay":-103.19382036154268},"-167378430":{"jump":-233.56288713989318,"stay":-254.67218637690263},"-833748478":{"jump":-46.437402492611916,"stay":-112.61376825062634},"-1886518782":{"jump":-126.8403554190221,"stay":-122.86094646006778},"-1911684606":{"jump":-22.38294913097365,"stay":-213.85301378392543},"-1912208894":{"jump":-281.37783399770206,"stay":-262.57868191913633},"-1179134":{"jump":-371.884759678284,"stay":-826.0946263854139},"-30539262":{"jump":1.444375,"stay":-679.6646797352901},"-943324670":{"jump":-75.30078938563508,"stay":-104.44113633751817},"-972684798":{"jump":-147.6607604386836,"stay":-240.65315592390942},"-968490494":{"jump":-36.58579057666872,"stay":-141.3770692631262},"-166329854":{"jump":1.298121484375,"stay":-188.58722600685928},"-2020736510":{"jump":-76.81961599415942,"stay":-95.31756343140859},"-1903820286":{"jump":-64.49810290926806,"stay":-135.92770979339892},"-7470590":{"jump":1.444375,"stay":-355.88706898715066},"-1081212414":{"jump":-582.4122034171894,"stay":-1311.7510993146175},"-130558":{"jump":-236.66136460951526,"stay":-686.5095692602467},"-2046426622":{"jump":1,"stay":-108.91394240217362},"-1610612738":{"jump":-285.35986079461156,"stay":-297.8355286127693},"-1751252478":{"jump":-69.12728323843575,"stay":-101.28833473908513},"-1073741826":{"jump":-197.78296738058947,"stay":-330.2872404699658},"-269614590":{"jump":-58.16116501628651,"stay":-154.01196391657038},"-3276286":{"jump":-674.8425915595569,"stay":-510.12114147079956},"-1643249150":{"jump":-107.6670075688524,"stay":-251.07719249888314},"-271711742":{"jump":-118.3246965168318,"stay":-156.45005397540945},"-536870914":{"jump":1,"stay":-268.65063781725013},"-837942782":{"jump":-237.12041757784078,"stay":-282.2308691532285},"-1777991166":{"jump":1,"stay":-13.170815319925376},"-2019687934":{"jump":-23.8628673471,"stay":-98.25365838280491},"-6422014":{"jump":1.225,"stay":-122.4366473334925},"-1080163838":{"jump":-249.025,"stay":-234.8522514125662},"-275906046":{"jump":1,"stay":-120.11619259483913},"-298974718":{"jump":1,"stay":-125.62590581577199},"-268435458":{"jump":1,"stay":-111.76582411076905},"-834272766":{"jump":1,"stay":-21.187779541734766},"-1635384830":{"jump":1,"stay":-48.05422065117961}};

function addNewState(state) {
    if (!qtable[state]) {
        qtable[state] = { jump: 1, stay: 1 };
    }
    return qtable[state];
}

function failed() {
    var data = ctx.getImageData(384, 320, 1, 1).data;
    return data[0] == 222;
}

function jump() {
    var evt = document.createEvent("MouseEvent");
    evt.initMouseEvent("mousedown", true, true, window,
        0, 0, 0, 0, 0, false, false, false, false, 0, null);
    testCanvas.dispatchEvent(evt);
}

function getState() {
    var ret = 0;

    for (var i = 0; i < 32; i++) {
        var x = 448 + 96 * Math.floor((i - (i % 8)) / 8);
        var y = 96 + 96 * (i % 8);
        var data = ctx.getImageData(x, y, 1, 1).data;
        if (data[0] != 112 || data[1] != 197 || data[206]) {
            ret = (ret | 1) << 1;
        } else {
            ret = ret << 1;
        }
    }
    return ret;
}

function getBestAction(state) {
    var actions = qtable[state] || addNewState(state);
    return actions.jump > actions.stay;
}

function getBestActionQ(state) {
    var actions = qtable[state] || addNewState(state);
    return actions.jump > actions.stay ? actions.jump : actions.stay;
}

function nextAction(state) {
    if (Math.random() < epsilon) {
        return Math.random() < 0.5;
    } else {
        getBestAction(state);
    }
}

function update(state, action, newQ) {
    if (action) {
        qtable[state].jump = newQ;
    } else {
        qtable[state].stay = newQ;
    }
}

function qval(state, action) {
    var actions = qtable[state] || addNewState(state);
    return action ? actions.jump : actions.stay;
}

function midlevel() {
    for (var i = 0; i < 8; i++) {
        var data = ctx.getImageData(348, 384 + i * 32, 1, 1).data;
        if (data[0] != 112 || data[1] != 197 || data[206])
            return true;
    }
    return false;
}

function reward() {
    return failed() ? PUNISHMENT :
           midlevel() ? REWARD_MID : REWARD_DEFAULT;
}

function learn(curr, next, action) {
    var oldQ = qval(curr, action);
    var newQ = oldQ + alpha * (reward() + gamma * getBestActionQ(next) - oldQ);
    update(curr, action, newQ);
}

var interval = null;
// function restart() {
    // console.log("trying retart");
    // window.setTimeout(function () {
        // var evt = document.createEvent("MouseEvent");
        // evt.initMouseEvent("mousedown", true, true, window,
        //     0, 175, 601, 175, 503, false, false, false, false, 0, null);
        // testCanvas.dispatchEvent(evt);
        // interval = setInterval(go, 10);
    // }, 1000);
// }

var lastAction = false;
var lastState = getState();

function go() {
    var state = getState();
    learn(lastState, state, lastAction,
        failed() ? -1000 : 1);

    var action = nextAction(state);
    if (action) jump();

    lastAction = action;
    lastState = state;

    if (failed()) {
        restart();
        jump();
    }
}

interval = setInterval(go, 50);
